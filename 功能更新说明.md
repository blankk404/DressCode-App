# DressCode - 功能更新说明

## 📅 更新日期：2025-12-19

## 🎉 本次更新内容

### 1. ✅ 个人中心功能完善

#### 1.1 用户信息同步显示
- **功能描述**：登录后个人中心自动显示用户真实信息
- **包含内容**：
  - 显示用户昵称
  - 显示用户性别
  - 显示加入天数（根据注册时间自动计算）
  - 头像显示框架（预留图片加载）

#### 1.2 退出登录功能
- **功能描述**：实现完整的退出登录流程
- **包含内容**：
  - 确认对话框提示
  - 清除本地登录状态
  - 清除ViewModel中的用户数据
  - 自动跳转到启动页

### 2. ✅ 编辑资料功能

#### 2.1 EditProfileActivity
- **功能描述**：用户可以编辑个人资料
- **可编辑内容**：
  - ✅ 昵称（必填）
  - ✅ 性别（男/女/保密）
  - ✅ 头像（点击"更换头像"，功能框架已实现）
- **只读信息**：
  - 用户名（不可修改）
  - 手机号（不可修改）

#### 2.2 数据验证
- 昵称不能为空
- 修改后自动保存到数据库
- 保存成功后自动返回个人中心

### 3. ✅ 身材档案系统

#### 3.1 BodyProfile实体类
**包含字段：**
- `height` - 身高（cm）
- `weight` - 体重（kg）
- `bmi` - BMI指数（自动计算）
- `headCircumference` - 头围（cm）
- `shoulderWidth` - 肩宽（cm）
- `waistCircumference` - 腰围（cm）
- `chestCircumference` - 胸围（cm）
- `hipCircumference` - 臀围（cm）
- `shoeSizeEu` - 鞋码（欧码）
- `updatedAt` - 更新时间

**特色功能：**
- ✅ 自动计算BMI指数
- ✅ BMI状态判断（偏瘦/正常/偏胖/肥胖）
- ✅ 与用户表建立外键关联
- ✅ 删除用户时自动级联删除档案

#### 3.2 BodyProfileActivity
**功能特点：**
- ✅ 精美的BMI展示卡片
  - 渐变紫粉色背景
  - 大字体显示BMI数值
  - 实时显示BMI状态
- ✅ 实时BMI计算
  - 输入身高体重时自动计算
  - 无需保存即可查看BMI
- ✅ 完整的数据输入
  - 分组展示：基础信息、围度信息
  - Material Design输入框
  - 带单位后缀提示
- ✅ 数据持久化
  - 自动保存/更新档案
  - 支持多次编辑
  - 下次打开自动填充

#### 3.3 入口位置
- 个人中心 → "我的身材档案"（第一个菜单项）
- 醒目的紫色图标

## 🏗️ 技术实现

### 数据库更新
```
数据库版本：v1 → v2
新增表：body_profiles
外键关联：body_profiles.user_id → users.id (CASCADE)
```

### 新增文件清单

#### 实体类（1个）
- `BodyProfile.java` - 身材档案实体

#### DAO（1个）
- `BodyProfileDao.java` - 身材档案数据访问对象

#### Repository（1个）
- `BodyProfileRepository.java` - 身材档案数据仓库

#### ViewModel（1个）
- `BodyProfileViewModel.java` - 身材档案视图模型

#### Activity（2个）
- `EditProfileActivity.java` - 编辑资料页面
- `BodyProfileActivity.java` - 身材档案管理页面

#### 布局文件（2个）
- `activity_edit_profile.xml` - 编辑资料布局
- `activity_body_profile.xml` - 身材档案布局

#### 工具类（1个）
- `AvatarHelper.java` - 头像选择辅助类

#### 更新文件（5个）
- `AppDatabase.java` - 添加BodyProfile表
- `ProfileActivity.java` - 完善用户信息显示
- `activity_profile.xml` - 添加身材档案入口
- `strings.xml` - 添加相关字符串资源
- `AndroidManifest.xml` - 注册新Activity

## 📊 数据库表结构

### body_profiles表
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INTEGER | 主键 | PRIMARY KEY, AUTO_INCREMENT |
| user_id | INTEGER | 用户ID | FOREIGN KEY, NOT NULL, INDEX |
| height | REAL | 身高(cm) | - |
| weight | REAL | 体重(kg) | - |
| bmi | REAL | BMI指数 | - |
| head_circumference | REAL | 头围(cm) | - |
| shoulder_width | REAL | 肩宽(cm) | - |
| waist_circumference | REAL | 腰围(cm) | - |
| chest_circumference | REAL | 胸围(cm) | - |
| hip_circumference | REAL | 臀围(cm) | - |
| shoe_size_eu | REAL | 鞋码(欧码) | - |
| updated_at | INTEGER | 更新时间戳 | - |

## 🎨 UI设计亮点

### 1. 身材档案页面
- **BMI卡片**：
  - 使用CardView + 渐变背景
  - 大字号显示BMI数值（48sp）
  - 清晰的状态标签
  - 16dp圆角设计

- **输入区域**：
  - 分组布局（基础信息/围度信息）
  - OutlinedBox样式的输入框
  - 单位后缀自动显示
  - 12dp圆角输入框

### 2. 编辑资料页面
- **头像区域**：
  - 居中显示
  - 100dp圆形头像
  - "更换头像"操作按钮

- **信息区域**：
  - 只读字段灰色显示
  - 可编辑字段正常显示
  - 性别单选按钮组

## 💡 使用流程

### 编辑资料
1. 个人中心 → 点击"编辑资料"按钮
2. 修改昵称和性别
3. （可选）点击"更换头像"
4. 点击右上角"保存"
5. 自动返回个人中心

### 填写身材档案
1. 个人中心 → 点击"我的身材档案"
2. 填写身高和体重（必填）
   - 实时查看BMI计算结果
3. （可选）填写围度信息和鞋码
4. 点击"保存档案"
5. 下次打开自动加载已保存的数据

### 查看/编辑身材档案
1. 个人中心 → "我的身材档案"
2. 自动加载已保存的数据
3. 修改任意数据
4. 点击"保存档案"更新

## 🔧 BMI计算说明

### 计算公式
```
BMI = 体重(kg) / [身高(m)]²
```

### 状态判断标准
| BMI范围 | 状态 |
|---------|------|
| < 18.5 | 偏瘦 |
| 18.5 - 24 | 正常 |
| 24 - 28 | 偏胖 |
| ≥ 28 | 肥胖 |

### 实时计算
- 在输入框输入身高体重时自动计算
- 无需点击保存即可查看BMI
- BMI卡片实时更新显示

## 📝 数据验证规则

### 编辑资料
- ✅ 昵称：不能为空
- ✅ 性别：必须选择（默认"男"）
- ✅ 用户名：只读，不可修改
- ✅ 手机号：只读，不可修改

### 身材档案
- ✅ 身高：必填，数值类型
- ✅ 体重：必填，数值类型
- ⚪ 其他字段：选填，数值类型
- ✅ 自动验证数值格式
- ✅ 自动计算BMI

## 🚀 后续优化建议

### 头像功能
- [ ] 添加图片选择权限请求
- [ ] 实现图片裁剪功能
- [ ] 添加图片压缩
- [ ] 使用Glide加载图片
- [ ] 支持拍照上传

### 身材档案
- [ ] 添加历史记录
- [ ] BMI变化趋势图表
- [ ] 身材分析报告
- [ ] 穿搭建议（基于身材数据）
- [ ] 三维数据可视化

### 个人中心
- [ ] 添加更多统计数据
- [ ] 成就系统
- [ ] 个性化主题
- [ ] 分享功能

## ⚠️ 注意事项

1. **数据库版本**：已升级到v2，会清空旧数据
2. **头像功能**：目前是基础框架，需要添加图片加载库
3. **权限**：完整的头像功能需要存储权限
4. **数据精度**：身材数据使用float类型，支持小数
5. **BMI计算**：仅供参考，不作为医疗建议

## 📈 测试建议

### 功能测试
1. **编辑资料**
   - 修改昵称并保存
   - 切换性别并保存
   - 验证保存后的数据显示

2. **身材档案**
   - 首次创建档案
   - 查看BMI实时计算
   - 编辑已有档案
   - 验证数据持久化

3. **退出登录**
   - 确认对话框显示
   - 退出后跳转启动页
   - 重新登录验证数据

### UI测试
- 各页面布局适配
- 输入框交互
- 按钮点击反馈
- 加载状态显示
- 错误提示显示

## 🎯 完成度

### 已完成 ✅
- [x] 个人中心信息同步
- [x] 编辑资料功能
- [x] 身材档案实体设计
- [x] 身材档案CRUD操作
- [x] BMI自动计算
- [x] 数据持久化
- [x] 退出登录功能
- [x] 头像功能框架

### 待完善 ⏳
- [ ] 头像上传和裁剪
- [ ] 图片加载优化
- [ ] 数据导出功能
- [ ] 身材分析报告

---

**开发团队**：DressCode Team  
**技术栈**：MVVM + Room + LiveData  
**更新版本**：v0.2.0

